
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Additional material Â· PEP root6 workshop</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-katex/katex.min.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-panels/panels.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-block-align/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
        <link rel="stylesheet" href="../../css/website.css">
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="../python/" />
    
    
    <link rel="prev" href="TDataFrame.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../">
            
                <a href="../../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../introduction.html">
            
                <a href="../introduction.html">
            
                    
                    Part 1 - Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../feat1.html">
            
                <a href="../feat1.html">
            
                    
                    Part 2 - New C++ features
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../feat2.html">
            
                <a href="../feat2.html">
            
                    
                    Part 3 - Smart (and dumb) pointers
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../newf2/intro.html">
            
                <a href="../newf2/intro.html">
            
                    
                    Pointers, the absolute basics
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../newf2/smartp.html">
            
                <a href="../newf2/smartp.html">
            
                    
                    Smart pointers
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../parallellism.html">
            
                <a href="../parallellism.html">
            
                    
                    Part 4 - Parallellism
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../parallell/intro.html">
            
                <a href="../parallell/intro.html">
            
                    
                    Threads and processes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../parallell/example.html">
            
                <a href="../parallell/example.html">
            
                    
                    Posix multithreading
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="../parallell/root.html">
            
                <a href="../parallell/root.html">
            
                    
                    Parallellism with ROOT
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../changes.html">
            
                <a href="../changes.html">
            
                    
                    Part 5 - 5 to 6: changes to user code
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../vectorization.html">
            
                <a href="../vectorization.html">
            
                    
                    Part 6 - Vectorization
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="declarative.html">
            
                <a href="declarative.html">
            
                    
                    Part 7 - Declarative analysis
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="concept.html">
            
                <a href="concept.html">
            
                    
                    Declarative programming
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2" data-path="TDataFrame.html">
            
                <a href="TDataFrame.html">
            
                    
                    TDataFrame
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.8.3" data-path="more.html">
            
                <a href="more.html">
            
                    
                    Additional material
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="../python/">
            
                <a href="../python/">
            
                    
                    Part 8 - Python
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" data-path="../python/running.html">
            
                <a href="../python/running.html">
            
                    
                    Running
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2" data-path="../python/operators.html">
            
                <a href="../python/operators.html">
            
                    
                    Objects and operators
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3" data-path="../python/numbers.html">
            
                <a href="../python/numbers.html">
            
                    
                    Numbers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.4" data-path="../python/strings.html">
            
                <a href="../python/strings.html">
            
                    
                    Strings
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.5" data-path="../python/lists.html">
            
                <a href="../python/lists.html">
            
                    
                    Lists and looping
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.6" data-path="../python/dictionaries.html">
            
                <a href="../python/dictionaries.html">
            
                    
                    Dictionaries
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.7" data-path="../python/conditions.html">
            
                <a href="../python/conditions.html">
            
                    
                    Conditions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.8" data-path="../python/methods.html">
            
                <a href="../python/methods.html">
            
                    
                    Methods
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.9" data-path="../python/scripting.html">
            
                <a href="../python/scripting.html">
            
                    
                    Scripting
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.10" data-path="../python/modules.html">
            
                <a href="../python/modules.html">
            
                    
                    Modules
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.11" data-path="../python/learning.html">
            
                <a href="../python/learning.html">
            
                    
                    Learning more
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.12" data-path="../python/pyroot.html">
            
                <a href="../python/pyroot.html">
            
                    
                    PyROOT
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="../bestprac/best_prac.html">
            
                <a href="../bestprac/best_prac.html">
            
                    
                    Part 9 - Best Practices
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.1" data-path="../bestprac/preparing.html">
            
                <a href="../bestprac/preparing.html">
            
                    
                    Preparing your code for debugging
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.2" data-path="../bestprac/general.html">
            
                <a href="../bestprac/general.html">
            
                    
                    Some general programming tips
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.3" data-path="../bestprac/crash.html">
            
                <a href="../bestprac/crash.html">
            
                    
                    Where does my code crash
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.4" data-path="../bestprac/memory.html">
            
                <a href="../bestprac/memory.html">
            
                    
                    Finding memory leaks
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../.." >Additional material</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="additional-material-to-tdataframe">Additional material to TDataFrame</h1>
<p>Here is a list of the most important features that have been omitted in the &quot;Crash course&quot; for brevity&apos;s sake. You don&apos;t need to read all these to start using TDataFrame, but they are useful to save typing time and runtime.</p>
<p>A wide range of topics is also covered in tutorials that can be found <a href="https://root.cern.ch/doc/v612/group__tutorial__tdataframe.html" target="_blank">here</a>.</p>
<h6 id="default-branch-lists">Default branch lists</h6>
<p>When constructing a TDataFrame object, it is possible to specify a default branch list for your analysis, in the usual form of a list of strings representing branch names. The default branch list will be used as fallback whenever one specific to the transformation/action is not present.</p>
<pre><code class="lang-c++"><span class="hljs-comment">// use &quot;b1&quot; and &quot;b2&quot; as default branches for &apos;Filter&apos;, &apos;Define&apos; and actions</span>
ROOT::Experimental::<span class="hljs-function">TDataFrame <span class="hljs-title">d1</span><span class="hljs-params">(treeName, &amp;file, {<span class="hljs-string">&quot;b1&quot;</span>,<span class="hljs-string">&quot;b2&quot;</span>})</span></span>;
<span class="hljs-comment">// filter acts on default branch list, no need to specify it</span>
<span class="hljs-keyword">auto</span> h = d1.Filter([](<span class="hljs-keyword">int</span> b1, <span class="hljs-keyword">int</span> b2) { <span class="hljs-keyword">return</span> b1 &gt; b2; }).Histo1D(<span class="hljs-string">&quot;otherVar&quot;</span>);
<span class="hljs-comment">// just one default branch this time</span>
ROOT::Experimental::<span class="hljs-function">TDataFrame <span class="hljs-title">d2</span><span class="hljs-params">(treeName, &amp;file, {<span class="hljs-string">&quot;b1&quot;</span>})</span></span>;
<span class="hljs-comment">// we can still specify non-default branch lists</span>
<span class="hljs-comment">// &apos;Min&apos; here can fall back to the default &quot;b1&quot;</span>
<span class="hljs-keyword">auto</span> min = d2.Filter([](<span class="hljs-keyword">double</span> b2) { <span class="hljs-keyword">return</span> b2 &gt; <span class="hljs-number">0</span>; }, {<span class="hljs-string">&quot;b2&quot;</span>}).Min();
Branch type guessing and <span class="hljs-keyword">explicit</span> declaration of branch types
</code></pre>
<p>C++ is a statically typed language: all types must be known at compile-time. This includes the types of the TTree branches we want to work on. For filters, temporary columns and some of the actions, branch types are deduced from the signature of the relevant filter function/temporary column expression/action function:</p>
<pre><code class="lang-c++"><span class="hljs-comment">// here b1 is deduced to be &apos;int&apos; and b2 to be &apos;double&apos;</span>
dataFrame.Filter([]\(<span class="hljs-keyword">int</span> x, <span class="hljs-keyword">double</span> y) { <span class="hljs-keyword">return</span> x &gt; <span class="hljs-number">0</span> &amp;&amp; y &lt; <span class="hljs-number">0.</span>; }, {<span class="hljs-string">&quot;b1&quot;</span>, <span class="hljs-string">&quot;b2&quot;</span>});
</code></pre>
<p>If we specify an incorrect type for one of the branches, an exception with an informative message will be thrown at runtime, when the branch value is actually read from the TTree: the implementation of TDataFrame allows the detection of type mismatches. The same would happen if we swapped the order of &quot;b1&quot; and &quot;b2&quot; in the branch list passed to Filter.</p>
<p>Certain actions, on the other hand, do not take a function as argument (e.g. Histo1D), so we cannot deduce the type of the branch at compile-time. In this case <strong>TDataFrame tries to guess the type of the branch</strong>, trying out the most common ones and std::vector thereof. This is why we never needed to specify the branch types for all actions in the above snippets.</p>
<p>When the branch type is not a common one such as int, double, char or float it is therefore good practice to specify it as a template parameter to the action itself, like this:</p>
<pre><code class="lang-c++">dataFrame.Histo1D(<span class="hljs-string">&quot;b1&quot;</span>); <span class="hljs-comment">// OK if b1 is a &quot;common&quot; type</span>
dataFrame.Histo1D&lt;Object_t&gt;(<span class="hljs-string">&quot;myObject&quot;</span>); <span class="hljs-comment">// OK, &quot;myObject&quot; is deduced to be of type &apos;Object_t&apos;</span>
<span class="hljs-comment">// dataFrame.Histo1D(&quot;myObject&quot;); // THROWS an exception</span>
</code></pre>
<h6 id="generic-actions">Generic actions</h6>
<p>TDataFrame strives to offer a comprehensive set of standard actions that can be performed on each event. At the same time, it allows users to execute arbitrary code (i.e. a generic action) inside the event loop through the Foreach and ForeachSlot actions.</p>
<p>Foreach(f, branchList) takes a function f (lambda expression, free function, functor...) and a list of branches, and executes f on those branches for each event. The function passed must return nothing (i.e. void). It can be used to perform actions that are not already available in the interface. For example, the following snippet evaluates the root mean square of branch &quot;b&quot;:</p>
<pre><code class="lang-c++"><span class="hljs-comment">// Single-thread evaluation of RMS of branch &quot;b&quot; using Foreach</span>
<span class="hljs-keyword">double</span> sumSq = <span class="hljs-number">0.</span>;
<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> n = <span class="hljs-number">0</span>;
ROOT::Experimental::<span class="hljs-function">TDataFrame <span class="hljs-title">d</span><span class="hljs-params">(<span class="hljs-string">&quot;bTree&quot;</span>, bFilePtr)</span></span>;
d.Foreach(\[&amp;sumSq, &amp;n](<span class="hljs-keyword">double</span> b) { ++n; sumSq += b*b; }, {<span class="hljs-string">&quot;b&quot;</span>});
<span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">&quot;rms of b: &quot;</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">sqrt</span>(sumSq / n) &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
</code></pre>
<p>When executing on multiple threads, users are responsible for the thread-safety of the expression passed to Foreach. The code above would need to employ some resource protection mechanism to ensure non-concurrent writing of rms; but this is probably too much head-scratch for such a simple operation.</p>
<p>ForeachSlot can help in this situation. It is an alternative version of Foreach for which the function takes an additional parameter besides the branches it should be applied to: an unsigned int slot parameter, where slot is a number indicating which thread (0, 1, 2 , ..., poolSize - 1) the function is being run in. We can take advantage of ForeachSlot to evaluate a thread-safe root mean square of branch &quot;b&quot;:</p>
<pre><code class="lang-c++"><span class="hljs-comment">// Thread-safe evaluation of RMS of branch &quot;b&quot; using ForeachSlot</span>
ROOT::EnableImplicitMT();
<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> nSlots = ROOT::GetImplicitMTPoolSize();
<span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">double</span>&gt; sumSqs(nSlots, <span class="hljs-number">0.</span>);
<span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>&gt; ns(nSlots, <span class="hljs-number">0</span>);
ROOT::Experimental::<span class="hljs-function">TDataFrame <span class="hljs-title">d</span><span class="hljs-params">(<span class="hljs-string">&quot;bTree&quot;</span>, bFilePtr)</span></span>;
d.ForeachSlot(\[&amp;sumSqs, &amp;ns](<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> slot, <span class="hljs-keyword">double</span> b) { sumSqs[slot] += b*b; ns[slot] += <span class="hljs-number">1</span>; }, {<span class="hljs-string">&quot;b&quot;</span>});
<span class="hljs-keyword">double</span> sumSq = <span class="hljs-built_in">std</span>::accumulate(sumSqs.begin(), sumSqs.end(), <span class="hljs-number">0.</span>); <span class="hljs-comment">// sum all squares</span>
<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> n = <span class="hljs-built_in">std</span>::accumulate(ns.begin(), ns.end(), <span class="hljs-number">0</span>); <span class="hljs-comment">// sum all counts</span>
<span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">&quot;rms of b: &quot;</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">sqrt</span>(sumSq / n) &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
</code></pre>
<p>You see how we created one double variable for each thread in the pool, and later merged their results via std::accumulate.</p>
<h6 id="call-graphs-storing-and-reusing-sets-of-transformations">Call graphs (storing and reusing sets of transformations)</h6>
<p>Sets of transformations can be stored as variables** and reused multiple times to create call graphs in which several paths of filtering/creation of branches are executed simultaneously; we often refer to this as &quot;storing the state of the chain&quot;.</p>
<p>This feature can be used, for example, to create a temporary column once and use it in several subsequent filters or actions, or to apply a strict filter to the data-set before executing several other transformations and actions, effectively reducing the amount of events processed.</p>
<p>Let&apos;s try to make this clearer with a commented example:</p>
<pre><code class="lang-c++"><span class="hljs-comment">// build the data-frame and specify a default branch list</span>
ROOT::Experimental::<span class="hljs-function">TDataFrame <span class="hljs-title">d</span><span class="hljs-params">(treeName, filePtr, {<span class="hljs-string">&quot;var1&quot;</span>, <span class="hljs-string">&quot;var2&quot;</span>, <span class="hljs-string">&quot;var3&quot;</span>})</span></span>;
<span class="hljs-comment">// apply a cut and save the state of the chain</span>
<span class="hljs-keyword">auto</span> filtered = d.Filter(myBigCut);
<span class="hljs-comment">// plot branch &quot;var1&quot; at this point of the chain</span>
<span class="hljs-keyword">auto</span> h1 = filtered.Histo1D(<span class="hljs-string">&quot;var1&quot;</span>);
<span class="hljs-comment">// create a new branch &quot;vec&quot; with a vector extracted from a complex object (only for filtered entries)</span>
<span class="hljs-comment">// and save the state of the chain</span>
<span class="hljs-keyword">auto</span> newBranchFiltered = filtered.Define(<span class="hljs-string">&quot;vec&quot;</span>, [](<span class="hljs-keyword">const</span> Obj&amp; o) { <span class="hljs-keyword">return</span> o.getVector(); }, {<span class="hljs-string">&quot;obj&quot;</span>});
<span class="hljs-comment">// apply a cut and fill a histogram with &quot;vec&quot;</span>
<span class="hljs-keyword">auto</span> h2 = newBranchFiltered.Filter(cut1).Histo1D(<span class="hljs-string">&quot;vec&quot;</span>);
<span class="hljs-comment">// apply a different cut and fill a new histogram</span>
<span class="hljs-keyword">auto</span> h3 = newBranchFiltered.Filter(cut2).Histo1D(<span class="hljs-string">&quot;vec&quot;</span>);
<span class="hljs-comment">// Inspect results</span>
h2-&gt;Draw(); <span class="hljs-comment">// first access to an action result: run event-loop!</span>
h3-&gt;Draw(<span class="hljs-string">&quot;SAME&quot;</span>); <span class="hljs-comment">// event loop does not need to be run again here..</span>
<span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">&quot;Entries in h1: &quot;</span> &lt;&lt; h1-&gt;GetEntries() &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>; <span class="hljs-comment">// ..or here</span>
</code></pre>
<p>TDataFrame detects when several actions use the same filter or the same temporary column, and only evaluates each filter or temporary column once per event, regardless of how many times that result is used down the call graph. Objects read from each branch are built once and never copied, for maximum efficiency. When &quot;upstream&quot; filters are not passed, subsequent filters, temporary column expressions and actions are not evaluated, so it might be advisable to put the strictest filters first in the chain.</p>
<h2 id="transformations">Transformations</h2>
<h6 id="filters">Filters</h6>
<p>A filter is defined through a call to Filter(f, branchList). f can be a function, a lambda expression, a functor class, or any other callable object. It must return a bool signalling whether the event has passed the selection (true) or not (false). It must perform &quot;read-only&quot; actions on the branches, and should not have side-effects (e.g. modification of an external or static variable) to ensure correct results when implicit multi-threading is active.</p>
<p>TDataFrame only evaluates filters when necessary: if multiple filters are chained one after another, they are executed in order and the first one returning false causes the event to be discarded and triggers the processing of the next entry. If multiple actions or transformations depend on the same filter, that filter is not executed multiple times for each entry: after the first access it simply serves a cached result.</p>
<h6 id="named-filters-and-cutflow-reports">Named filters and cutflow reports</h6>
<p>An optional string parameter name can be passed to the Filter method to create a named filter. Named filters work as usual, but also keep track of how many entries they accept and reject.</p>
<p>Statistics are retrieved through a call to the Report method:</p>
<p>when Report is called on the main TDataFrame object, it prints stats for all named filters declared up to that point
when called on a stored chain state (i.e. a chain/graph node), it prints stats for all named filters in the section of the chain between the main TDataFrame and that node (included).
Stats are printed in the same order as named filters have been added to the graph, and refer to the latest event-loop that has been run using the relevant TDataFrame. If Report is called before the event-loop has been run at least once, a run is triggered.</p>
<h6 id="ranges">Ranges</h6>
<p>When TDataFrame is not being used in a multi-thread environment (i.e. no call to EnableImplicitMT was made), Range transformations are available. These act very much like filters but instead of basing their decision on a filter expression, they rely on start,stop and stride parameters.</p>
<ul>
<li>start: number of entries that will be skipped before starting processing again</li>
<li>stop: maximum number of entries that will be processed</li>
<li>stride: only process one entry every stride entries
The actual number of entries processed downstream of a Range node will be (stop - start)/stride (or less if less entries than that are available).</li>
</ul>
<p>Note that ranges act &quot;locally&quot;, not based on the global entry count: Range(10,50) means &quot;skip the first 10 entries that reach this node*, let the next 40 entries pass, then stop processing&quot;. If a range node hangs from a filter node, and the range has a start parameter of 10, that means the range will skip the first 10 entries that pass the preceding filter.</p>
<p>Ranges allow &quot;early quitting&quot;: if all branches of execution of a functional graph reached their stop value of processed entries, the event-loop is immediately interrupted. This is useful for debugging and initial explorations.</p>
<h6 id="temporary-columns">Temporary columns</h6>
<p>Temporary columns are created by invoking Define(name, f, branchList). As usual, f can be any callable object (function, lambda expression, functor class...); it takes the values of the branches listed in branchList (a list of strings) as parameters, in the same order as they are listed in branchList. f must return the value that will be assigned to the temporary column.</p>
<p>A new variable is created called name, accessible as if it was contained in the dataset from subsequent transformations/actions.</p>
<p>Use cases include:</p>
<ul>
<li>caching the results of complex calculations for easy and efficient multiple access</li>
<li>extraction of quantities of interest from complex objects</li>
<li>branch aliasing, i.e. changing the name of a branch
An exception is thrown if the name of the new branch is already in use for another branch in the TTree.</li>
</ul>
<p>It is also possible to specify the quantity to be stored in the new temporary column as a C++ expression with the method Define(name, expression). For example this invocation</p>
<pre><code class="lang-c++">tdf.Define(<span class="hljs-string">&quot;pt&quot;</span>, <span class="hljs-string">&quot;sqrt(px*px + py*py)&quot;</span>);
</code></pre>
<p>will create a new column called &quot;pt&quot; the value of which is calculated starting from the branches px and py. The system builds a just-in-time compiled function starting from the expression after having deduced the list of necessary branches from the names of the variables specified by the user.</p>
<h2 id="actions">Actions</h2>
<h6 id="instant-and-lazy-actions">Instant and lazy actions</h6>
<p>Actions can be instant or lazy. Instant actions are executed as soon as they are called, while lazy actions are executed whenever the object they return is accessed for the first time. As a rule of thumb, actions with a return value are lazy, the others are instant.</p>
<h6 id="overview">Overview</h6>
<p>Here is a quick overview of what actions are present and what they do. Each one is described in more detail in the reference guide.</p>
<p>In the following, whenever we say an action &quot;returns&quot; something, we always mean it returns a smart pointer to it. Also note that all actions are only executed for events that pass all preceding filters.</p>
<table>
<thead>
<tr>
<th style="text-align:left">Lazy actions</th>
<th style="text-align:left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Count</td>
<td style="text-align:left">Return the number of events processed.</td>
</tr>
<tr>
<td style="text-align:left">Fill</td>
<td style="text-align:left">Fill a user-defined object with the values of the specified branches, as if by calling &apos;Obj.Fill(branch1, branch2, ...).</td>
</tr>
<tr>
<td style="text-align:left">Histo{1D,2D,3D}</td>
<td style="text-align:left">Fill a {one,two,three}-dimensional histogram with the processed branch values.</td>
</tr>
<tr>
<td style="text-align:left">Max</td>
<td style="text-align:left">Return the maximum of processed branch values.</td>
</tr>
<tr>
<td style="text-align:left">Mean</td>
<td style="text-align:left">Return the mean of processed branch values.</td>
</tr>
<tr>
<td style="text-align:left">Min</td>
<td style="text-align:left">Return the minimum of processed branch values.</td>
</tr>
<tr>
<td style="text-align:left">Profile{1D,2D}</td>
<td style="text-align:left">Fill a {one,two}-dimensional profile with the branch values that passed all filters.</td>
</tr>
<tr>
<td style="text-align:left">Reduce</td>
<td style="text-align:left">Reduce (e.g. sum, merge) entries using the function (lambda, functor...) passed as argument. The function must have signature T(T,T) where T is the type of the branch. Return the final result of the reduction operation. An optional parameter allows initialization of the result object to non-default values.</td>
</tr>
<tr>
<td style="text-align:left">Take</td>
<td style="text-align:left">Build a collection of values of a branch.</td>
</tr>
<tr>
<td style="text-align:left"><strong>Instant actions</strong></td>
<td style="text-align:left"><strong>Description</strong></td>
</tr>
<tr>
<td style="text-align:left">Foreach</td>
<td style="text-align:left">Execute a user-defined function on each entry. Users are responsible for the thread-safety of this lambda when executing with implicit multi-threading enabled.</td>
</tr>
<tr>
<td style="text-align:left">ForeachSlot</td>
<td style="text-align:left">Same as Foreach, but the user-defined function must take an extra unsigned int slot as its first parameter. slot will take a different value, 0 to nThreads - 1, for each thread of execution. This is meant as a helper in writing thread-safe Foreach actions when using TDataFrame after ROOT::EnableImplicitMT(). ForeachSlot works just as well with single-thread execution: in that case slot will always be 0.</td>
</tr>
<tr>
<td style="text-align:left">Snapshot</td>
<td style="text-align:left">Writes on disk a dataset made of the selected columns and entries passing the filters (if any).</td>
</tr>
<tr>
<td style="text-align:left"><strong>Queries</strong></td>
<td style="text-align:left"><strong>Description</strong></td>
</tr>
<tr>
<td style="text-align:left">Report</td>
<td style="text-align:left">This is not properly an action, since when Report is called it does not book an operation to be performed on each entry. Instead, it interrogates the data-frame directly to print a cutflow report, i.e. statistics on how many entries have been accepted and rejected by the filters. See the section on named filters for a more detailed explanation.</td>
</tr>
</tbody>
</table>
<h2 id="parallel-execution">Parallel execution</h2>
<p>As pointed out before in this document, TDataFrame can transparently perform multi-threaded event loops to speed up the execution of its actions. Users only have to call ROOT::EnableImplicitMT() before constructing the TDataFrame object to indicate that it should take advantage of a pool of worker threads. Each worker thread processes a distinct subset of entries, and their partial results are merged before returning the final values to the user.</p>
<h6 id="thread-safety">Thread safety</h6>
<p>Filter and Define transformations should be inherently thread-safe: they have no side-effects and are not dependent on global state. Most Filter/Define functions will in fact be pure in the functional programming sense. All actions are built to be thread-safe with the exception of Foreach, in which case users are responsible of thread-safety, see here.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="TDataFrame.html" class="navigation navigation-prev " aria-label="Previous page: TDataFrame">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="../python/" class="navigation navigation-next " aria-label="Next page: Part 8 - Python">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Additional material","level":"1.8.3","depth":2,"next":{"title":"Part 8 - Python","level":"1.9","depth":1,"path":"analysis/python/README.md","ref":"analysis/python/README.md","articles":[{"title":"Running","level":"1.9.1","depth":2,"path":"analysis/python/running.md","ref":"analysis/python/running.md","articles":[]},{"title":"Objects and operators","level":"1.9.2","depth":2,"path":"analysis/python/operators.md","ref":"analysis/python/operators.md","articles":[]},{"title":"Numbers","level":"1.9.3","depth":2,"path":"analysis/python/numbers.md","ref":"analysis/python/numbers.md","articles":[]},{"title":"Strings","level":"1.9.4","depth":2,"path":"analysis/python/strings.md","ref":"analysis/python/strings.md","articles":[]},{"title":"Lists and looping","level":"1.9.5","depth":2,"path":"analysis/python/lists.md","ref":"analysis/python/lists.md","articles":[]},{"title":"Dictionaries","level":"1.9.6","depth":2,"path":"analysis/python/dictionaries.md","ref":"analysis/python/dictionaries.md","articles":[]},{"title":"Conditions","level":"1.9.7","depth":2,"path":"analysis/python/conditions.md","ref":"analysis/python/conditions.md","articles":[]},{"title":"Methods","level":"1.9.8","depth":2,"path":"analysis/python/methods.md","ref":"analysis/python/methods.md","articles":[]},{"title":"Scripting","level":"1.9.9","depth":2,"path":"analysis/python/scripting.md","ref":"analysis/python/scripting.md","articles":[]},{"title":"Modules","level":"1.9.10","depth":2,"path":"analysis/python/modules.md","ref":"analysis/python/modules.md","articles":[]},{"title":"Learning more","level":"1.9.11","depth":2,"path":"analysis/python/learning.md","ref":"analysis/python/learning.md","articles":[]},{"title":"PyROOT","level":"1.9.12","depth":2,"path":"analysis/python/pyroot.md","ref":"analysis/python/pyroot.md","articles":[]}]},"previous":{"title":"TDataFrame","level":"1.8.2","depth":2,"path":"analysis/tdf/TDataFrame.md","ref":"analysis/tdf/TDataFrame.md","articles":[]},"dir":"ltr"},"config":{"plugins":["katex","panels@git+https://github.com/lhcb/gitbook-plugin-panels.git#117012fdc18c96831cb88196980c0ea73b0c87b8","collapsible-menu","block-align"],"styles":{"website":"css/website.css"},"pluginsConfig":{"collapsible-menu":{},"block-align":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"panels":{},"katex":{},"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"PEP root6 workshop","gitbook":"*","description":"PEP root6 introduction material"},"file":{"path":"analysis/tdf/more.md","mtime":"2018-11-17T11:44:22.000Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2020-08-05T09:20:43.977Z"},"basePath":"../..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-panels/panels.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-collapsible-menu/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

